# 스마트 농업 대시보드 앱 분석 보고서

본 보고서는 현재 폴더의 파이썬 기반 스마트 농업 대시보드 앱을 분석한 결과입니다.

---

## 1. 앱의 특징

### 🚀 하이브리드 검색 시스템 (Semantic + SQL)
*   **의도 기반 검색:** `Sentence Transformers`(`jhgan/ko-sroberta-multitask`)를 사용하여 사용자의 질문 의도를 파악하는 시맨틱 검색을 제공합니다. (예: "고추 잎이 시들시들해" → 병해충 관리 데이터 매칭)
*   **고조된 성능:** `DuckDB`의 `vss` 확장을 활용하여 벡터 유사도 검색(Cosine Similarity)을 로컬 환경에서 초고속으로 수행합니다.

### 📊 시계열 분석 및 대시보드
*   **오늘의 브리핑:** 현재 날짜를 기준으로 과거 3년 동안의 동기 기상 및 요약 정보를 자동으로 추출하여 보여주는 기능을 갖추고 있습니다.
*   **시즌성 키워드 추천:** 월별(계절별)로 농사에 필요한 핵심 키워드(예: 1월-월동 관리, 6월-장마 대비)를 사이드바에서 추천합니다.

### 🛠️ 데이터 파이프라인 최적화
*   **Granular Flattening:** `embed.py`를 통해 원본 JSONL 데이터를 카테고리별(양봉, 기상, 벼 등)로 세분화하여 저장함으로써 검색의 정확도를 높였습니다.
*   **벌크 인서트:** Pandas DataFrame을 거쳐 DuckDB로 데이터를 일괄 삽입하여 대용량 데이터 처리 속도를 확보했습니다.

---

## 2. 문제점

### 🔒 동시성 및 잠금(Locking) 문제
*   현재 `app_dashboard.py`와 `embed.py`가 동일한 `.duckdb` 파일을 참조하고 있습니다. DuckDB는 기본적으로 단일 프로세스 쓰기를 지원하므로, 인덱스 생성이나 데이터 갱신 중 앱을 실행하면 파일 잠금 오류가 발생할 가능성이 큽니다.

### 📉 확장성 및 정규화 부족
*   `farming` 테이블 하나에 모든 데이터가 집중되어 있습니다. 데이터량이 수백만 건 이상으로 늘어날 경우, 단순 `SELECT *` 형태의 벡터 검색 서브쿼리는 성능 저하를 야기할 수 있습니다.
*   카테고리 정보가 텍스트로 중복 저장되어 있어 저장 공간 효율이 떨어집니다.

### 🧩 검색 결과 하이라이팅의 한계
*   현재 결과 출력 시 `replace` 함수를 이용한 단순 하이라이팅을 사용합니다. 시맨틱 검색 결과는 키워드가 정확히 일치하지 않아도 검색되는데, 이 경우 사용자에게 왜 이 결과가 선택되었는지 시각적 피드백(하이라이팅)을 주기 어렵습니다.

---

## 3. 개선책

### ⚡ 비동기 처리 및 캐싱 강화
*   `st.cache_resource` 뿐만 아니라 검색 결과 자체에 대해 `st.cache_data`를 적용하여 동일 쿼리에 대한 반복 연산을 줄여야 합니다.

### 🔍 고급 하이라이팅 도입
*   검색된 문장에서 질문 벡터와 가장 유사도가 높은 부분(Segment)만 추출하여 보여주거나, 키워드 기반의 `BM25` 알고리즘을 결합(Hybrid Search)하여 하이라이팅 정확도를 높여야 합니다.

### 🛡️ 에러 핸들링 보강
*   DuckDB 연결 시 `read_only=True` 옵션을 사용 중이지만, 파일이 없거나 확장 기능(`vss`) 로드 실패 시의 예외 처리가 더 견고해야 합니다.

---

## 4. DuckDB 활용 극대화 제언

### 💎 가상 컬럼 및 인덱스 최적화
*   **HNSW 인덱스:** 현재 `HNSW` 인덱스를 생성하고 있는데, `ef_construction` 및 `M` 파라미터를 데이터 특성에 맞게 튜닝하여 검색 속도와 정확도 사이의 균형을 맞춰야 합니다.
*   **Full-Text Search (FTS) 결합:** `vss` 외에 DuckDB의 내장 FTS 기능을 사용하여 "정확한 키워드 + 시맨틱 맥락"을 합산한 하이브리드 스코어링을 구현할 것을 권장합니다.

### 📂 데이터 파티셔닝
*   `year`나 `month` 컬럼을 기준으로 데이터를 물리적으로 분리하거나 `VIEW`를 활용하여 쿼리 범위를 제한함으로써 스캔 성능을 극대화할 수 있습니다.

### 🧊 임베딩 관리 전략
*   임베딩 컬럼(`FLOAT[768]`)은 용량을 많이 차지합니다. 데이터가 방대해질 경우 `Quantization`(양자화)을 고려하거나, 자주 사용되지 않는 과거 데이터는 별도의 압축 테이블로 아카이빙하는 전략이 필요합니다.

### 🚀 결과 분석용 SQL 활용
*   간순 검색을 넘어, DuckDB의 강력한 집계 기능을 활용해 "최근 5년간 탄저병 언급 빈도 추이" 및 "월별 카테고리 분포 변화"와 같은 통계형 대시보드 기능을 추가하면 도구의 가치가 더욱 높아질 것입니다.
